<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Movies</title>

    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>

        body {
            padding: 40px;
            font-family: Arial, Helvetica, sans-serif;
            background: #2b2b2b;
            color: #e6e6e6;
        }

        @media (prefers-color-scheme: light) {
            body {
                background:#f4f6f8;
                color:#333;
            }
        }

        h2 {
            margin-bottom: 15px;
        }

        a[href="/movies/new"] {
            display:inline-block;
            margin-bottom:15px;
            padding:10px 14px;
            border-radius:6px;
            background:#2ecc71;
            color:#fff !important;
            font-weight:600;
            text-decoration:none;
        }

        a[href="/movies/new"]:hover {
            background:#27ae60;
        }

        form[action="/movies"] {
            background:#3c3f41;
            padding:12px 14px;
            border-radius:8px;
            border:1px solid #5a5a5a;
        }

        @media (prefers-color-scheme: light){
            form[action="/movies"]{
                background:white;
                border:1px solid #e3e6ec;
            }
        }

        form[action="/movies"] input {
            padding:7px 10px;
            border-radius:6px;
            border:1px solid #666;
            background:#2b2b2b;
            color:white;
        }

        @media (prefers-color-scheme: light) {
            form[action="/movies"] input {
                background:white;
                color:black;
                border:1px solid #ccc;
            }
        }

        form[action="/movies"] button {
            padding:7px 12px;
            border-radius:6px;
            border:none;
            background:#0d6efd;
            color:white;
        }

        form[action="/movies"] a {
            margin-left:10px;
            text-decoration:none;
            color:#ff6b6b;
            font-weight:600;
        }

        table {
            width:100%;
            border-radius:10px;
            overflow:hidden;
            border:1px solid #555;
            background:#3c3f41;
        }

        @media (prefers-color-scheme: light){
            table {
                background:white;
                border:1px solid #ddd;
            }
        }

        th, td {
            padding:12px 14px;
            border-bottom:1px solid #555;
        }

        th {
            background:#4b4f51;
        }

        @media (prefers-color-scheme: light){
            th {
                background:#f1f4fb;
            }
        }

        tr:nth-child(even){
            background:#35393b;
        }

        @media (prefers-color-scheme: light){
            tr:nth-child(even){
                background:#fafafa;
            }
        }

        tr:hover {
            background:#2f6aff33;
        }

        td:last-child {
            white-space:nowrap;
        }

        td a {
            padding:6px 10px;
            border-radius:5px;
            background:#ffc107;
            color:#000 !important;
            text-decoration:none;
            font-weight:600;
        }

        td form button {
            padding:6px 10px;
            border-radius:5px;
            border:none;
            background:#dc3545;
            color:white;
            font-weight:600;
            cursor:pointer;
        }

        td form button:hover {
            background:#c82333;
        }

        /* Notification */
        #deleteNotification {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: #28a745;
            color: white;
            padding: 12px 18px;
            border-radius: 6px;
            font-weight: 600;
            display: none;
        }

        /* ===== Flash messages (Success / Error) ===== */
.flash {
    padding: 12px 14px;
    border-radius: 10px;
    font-weight: 600;
    margin: 12px 0 16px;
    border: 1px solid transparent;
    display: flex;
    align-items: center;
    gap: 10px;
}

.flash .icon {
    width: 26px;
    height: 26px;
    border-radius: 8px;
    display: grid;
    place-items: center;
    font-size: 14px;
    flex: 0 0 auto;
}

.flash .text {
    margin: 0;
    line-height: 1.2;
}

/* Success */
.flash-success {
    background: rgba(46, 204, 113, 0.15);
    border-color: rgba(46, 204, 113, 0.35);
    color: #d7ffe8;
}
.flash-success .icon {
    background: rgba(46, 204, 113, 0.25);
    border: 1px solid rgba(46, 204, 113, 0.45);
}

/* Error */
.flash-error {
    background: rgba(220, 53, 69, 0.15);
    border-color: rgba(220, 53, 69, 0.35);
    color: #ffe1e6;
}
.flash-error .icon {
    background: rgba(220, 53, 69, 0.25);
    border: 1px solid rgba(220, 53, 69, 0.45);
}

/* Light mode */
@media (prefers-color-scheme: light) {
    .flash-success {
        background: rgba(40, 167, 69, 0.12);
        border-color: rgba(40, 167, 69, 0.30);
        color: #145a32;
    }
    .flash-success .icon {
        background: rgba(40, 167, 69, 0.18);
        border-color: rgba(40, 167, 69, 0.25);
        color: #145a32;
    }

    .flash-error {
        background: rgba(220, 53, 69, 0.10);
        border-color: rgba(220, 53, 69, 0.28);
        color: #7a0f1b;
    }
    .flash-error .icon {
        background: rgba(220, 53, 69, 0.16);
        border-color: rgba(220, 53, 69, 0.22);
        color: #7a0f1b;
    }
}

    </style>
</head>

<body>

<h2>Movies</h2>

<!-- Flash messages -->
<div th:if="${success}" class="flash flash-success">
    <div class="icon">✓</div>
    <p class="text" th:text="${success}"></p>
</div>

<div th:if="${error}" class="flash flash-error">
    <div class="icon">!</div>
    <p class="text" th:text="${error}"></p>
</div>


<a href="/movies/new">Add Movie</a>

<form method="get" action="/movies">
    <a th:href="@{/movies(
        sortBy='title',
        direction=${sortBy == 'title' and direction == 'asc' ? 'desc' : 'asc'}
    )}"> sort
        <span th:if="${sortBy == 'title'}"
              th:text="${direction == 'asc' ? '▲' : '▼'}"  ></span>
    </a> <br>

    Search by title:
    <input type="text" name="title" th:value="${title}" />

    Search by genre:
    <input type="text" name="genre" th:value="${genre}" />

    <button type="submit">Search</button>
    <a href="/movies">Reset</a>
</form>

<br>

<table border="1">
    <tr>
        <th>Title</th>
        <th>Genre</th>
        <th>Rating</th>
        <th>Release Date</th>
        <th>Duration</th>
        <th>Actions</th>
    </tr>

    <tr th:each="movie : ${movies}">
        <td th:text="${movie.title}"></td>
        <td th:text="${movie.genre}"></td>
        <td th:text="${movie.rating}"></td>
        <td th:text="${movie.releaseDate}"></td>
        <td th:text="${movie.duration}"></td>

        <td>
            <a th:href="@{/movies/{id}/edit(id=${movie.id})}">Edit</a>

            <form th:action="@{/movies/{id}/delete(id=${movie.id})}"
                  method="post"
                  style="display:inline;"
                  onsubmit="return handleDelete()">

                <button type="submit">Delete</button>
            </form>
        </td>
    </tr>
</table>


<!-- Notification -->
<div id="deleteNotification">
    Movie successfully deleted!
</div>


<script>
    function handleDelete() {
        if (!confirm("Вы уверены, что хотите удалить?")) {
            return false;
        }

        setTimeout(() => {
            const box = document.getElementById("deleteNotification");
            box.style.display = "block";

            setTimeout(() => {
                box.style.display = "none";
            }, 2500);
        }, 400);

        return true;
    }
</script>

</body>
</html>